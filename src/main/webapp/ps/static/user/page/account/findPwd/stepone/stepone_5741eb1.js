define("user:page/account/findPwd/stepone/stepone.js",function(require,exports,module){"use strict";var $=require("common:widget/lib/jquery/jquery"),service=(require("common:widget/ui/utils/utils"),require("common:widget/ui/service/service-factory")),userService=service.getService("user"),glpbCommon=require("common:node_modules/glpb-components-common/src/index"),RRDValidator=glpbCommon.RRDValidator,findpwd=(require("common:widget/lib/gt/gt"),{init:function(geetestData){this.geetestData=geetestData,geetestData&&geetestData.isGeetest&&this.initGt(geetestData),this.$randImage=$("#randImage"),this.originCaptcha=this.$randImage.attr("src"),this.handle()},handle:function(){var that=this;$("#mobileOrEmail").keyup(function(){that.validateMobileOrEmail()}),$("#code").keyup(function(){that.validateCode()}),this.$randImage.on("click",function(){that.$randImage.attr("src",that.originCaptcha+"?"+(new Date).getTime())}),$("#subNotLoginFindPswBt").on("click",function(){var geetestData=that.geetestData;if(geetestData&&geetestData.isGeetest){if(that.validateMobileOrEmail())return;that.captchaObj.verify()}else that.subFindPwdStepOne()})},subFindPwdStepOne:function(){var that=this;that.validateMobileOrEmail()||that.validateCode()||userService.isImage({code:$("#code").val()}).then(function(res){if(res.requestStatus!==userService.STATUS.SUCCESS){that.$randImage.attr("src",that.originCaptcha+"?"+(new Date).getTime());var msg=res.data?res.data.message:"请求后端服务出错, 请稍后再试";return Promise.reject(new Error(msg))}var data=res.data;0==data.status?$("#notLoginFindPswForm").submit():(that.$randImage.attr("src",that.originCaptcha+"?"+(new Date).getTime()),that.error=data.message,that.errorModal(1))}).caught(function(e){that.$randImage.attr("src",that.originCaptcha+"?"+(new Date).getTime()),that.error=e.message,that.errorModal(1)})},validateMobileOrEmail:function(){var mobileOrEmail=$("#mobileOrEmail").val(),isMobileOrEmail=RRDValidator.validate.isMobileOrEmail(mobileOrEmail),isSpace=-1==String(mobileOrEmail).indexOf(" ")?!0:!1;return mobileOrEmail?isSpace?isMobileOrEmail?(this.error="",this.errorModal(0),!1):(this.error="请输入正确的邮箱地址或手机号码",this.errorModal(0),!0):(this.error="不能有空格",this.errorModal(0),!0):(this.error="手机号/邮箱不能为空",this.errorModal(0),!0)},validateCode:function(){var code=$("#code").val();return code?(this.error="",this.errorModal(1),!1):(this.error="验证码不能为空",this.errorModal(1),!0)},errorModal:function(num){$("label.error").eq(num).text(this.error),this.error?$(".ui-input-setting").eq(num).addClass("error"):$(".ui-input-setting").eq(num).removeClass("error")},initGt:function(geetestData){initGeetest({gt:geetestData.gt,challenge:geetestData.challenge,offline:!geetestData.success,new_captcha:geetestData.new_captcha,product:"bind",width:"300px",pure:1},this.handlerGeetest.bind(this))},handlerGeetest:function(captchaObj){this.captchaObj=captchaObj;var that=this;captchaObj.onReady(function(){}),captchaObj.onNextReady(function(){}),captchaObj.onClose(function(){}),captchaObj.onError(function(){captchaObj.reset()}),captchaObj.onSuccess(function(){var result=captchaObj.getValidate();return result?($("#notLoginFindPswForm").find('input[name="geetest_challenge"]').val(result.geetest_challenge),$("#notLoginFindPswForm").find('input[name="geetest_validate"]').val(result.geetest_validate),$("#notLoginFindPswForm").find('input[name="geetest_seccode"]').val(result.geetest_seccode),void $("#notLoginFindPswForm").submit()):(that.error="请完成验证",void that.errorModal(1))})}});module.exports=findpwd});